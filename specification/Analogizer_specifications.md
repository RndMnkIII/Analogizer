#Analogizer Specifications

## Basics
 The basis of the Analogizer adapter is to expand the possibilities of the Analogue Pocket portable console in two fundamental aspects. On the one hand
 allow obtaining an analog video output from the video signals generated by the core before being adapted to the characteristics
 Pocket display. This means using the resolution, refresh rates, sync signals, etc. of the original core as it was.
 implemented to replicate the original system. No preprocessing of any kind is applied beyond adapting certain signals to be able to generate the
 different video outputs (RGBS,RGsB,YPbPr, Y/C,RGBHV). This video signal will be compatible with different types of screens, the main objective
 CRT displays with an operating frequency of 15KHz and with different types of video input: SCART RGB, SCART SVideo, SCART Composite, video
 component with YPbPr, SVideo, composite video. Additionally, using a scandoubler module, there will be the possibility of viewing the video using
 SVGA monitors. On the other hand, we want to add the possibility of using native game controllers with the Pocket cores. This is achieved using
 the already established base of official SNAC adapters for MiSTEr that use the SNAC7 protocol and USB 3 type A connector. Analogizer today
 offers SNAC support for 1/2 players for NeoGeo DB15, NES, SNES type controllers. Additionally, it offers 1-player support for PCEngine controllers.
 2 and 6 buttons. This support expands to 4 players using NEC's 5-player multitap adapter. For PCEngine type controls and NEC multitap
 It is necessary to use a wiring harness between the SNAC adapter and the Analogizer due to certain limitations of the Analogizer adapter (it does not have freedom
 to configure SNAC signals as input or output on an individual level and certain signals have a fixed output or input configuration) due to how
 The Pocket's cartridge expansion port works. The adapter has a side switch marked A/B, the default position being A. This
 affects the layout of signals for the SNAC port. Configuration A supports the types of controls listed above. B is reserved for
 future expansions, for example to support PSX controllers. All of this functionality consumes logic resources directly from the Pocket's Cyclone V FPGA.
 that must be shared with the implementation of the core in question to which you want to add support.

## Video output signals
 The main use of Analogizer is that it allows you to obtain different types of analog video signals. It is essential to implement all of them, especially
 the Y/C output for SVideo and composite video, taking into account that most of the CRT TV devices available to users only have this
 video inputs, followed by users with TVs with component video inputs and TVs with SCART inputs. SVGA output is considered accessory for users
 They do not have CRT TV screens but they do have SVGA video monitors.
 In order of video output quality on CRT, the following are recommended:
 * SCART RGB
 * YPbpr component video (requires R2 version of Analogizer with SOG)
 * Y/C SVideo
 * Y/C composite video
 * SVGA

## SNAC adapters for controllers
 The second most important functionality that Analogizer offers is that it allows you to use SNAC7 adapters with a USB 3 (type A) connector that already exist in Analogizer with certain limitations.
 This means that you can currently use native controllers that use 2- and 6-button Neogeo DB15, NES, SNES and PCEngine connectors and the NEC 5-player MultiTap adapter (currently 
 you are limited to 4 players by the Analogizer interface). That said, there are countless designs that in most cases will work without problems. In the README of the main Analogizer repository, the different types of adapters compatible with Analogizer will be added, there are versions for both 1 controller and 2 controllers (DB15, NES, SNES). For controls of the type
 PCEngine is also required to have a wiring harness specifically created for Analogizer (it is available for sale in the Analogizer online store and the pcb design is public for users interested in building it themselves). At one end it is connected to the SNAC adapter through a USB 3 female type A connector and at the other end it is
 connects Analogizer with a USB 3 male type A connector. USB 3 female-male extension cables can be used at the convenience of users and is the recommended connection method to avoid
 Excessive stress on the connectors if all these adapters are connected together directly.

 It must be taken into account that the Blue212 type SNAC adapters use two boards (one of them is specific to the native control and has the native connector but does not have its own circuitry). The other board is a common design for all controls and is connected directly to the previous one, it provides all the electronics to convert voltage levels between the controls signals.
 and Analogizer.

## Analogizer interface
As the creator of Analogizer I have also developed an interface in Verilog that encapsulates all the functionality in a single module that must be instantiated.
This module is the one that connects the different parts involved so that everything works correctly.
This module communicates with the adapter directly through the Pocket's cartridge expansion port. This port is available in the framework
of Analogue openFPGA for the developer, using the following signals instantiated in the highest level module as follows:

```
module apf_top (
...
        ///////////////////////////////////////////////////
        // cartridge interface
        // switches between 3.3v and 5v mechanically
        // output enable for multibit translators controlled by PIC32

        // GBA AD[15:8]
        inout   wire    [7:0]   cart_tran_bank2,
        output  wire            cart_tran_bank2_dir,

        // GBA AD[7:0]
        inout   wire    [7:0]   cart_tran_bank3,
        output  wire            cart_tran_bank3_dir,

        // GBA A[23:16]
        inout   wire    [7:0]   cart_tran_bank1,
        output  wire            cart_tran_bank1_dir,

        // GBA [7] PHI#
        // GBA [6] WR#
        // GBA [5] RD#
        // GBA [4] CS1#/CS#
        //     [3:0] unwired
        inout   wire    [7:4]   cart_tran_bank0,
        output  wire            cart_tran_bank0_dir,

        // GBA CS2#/RES#
        inout   wire            cart_tran_pin30,
        output  wire            cart_tran_pin30_dir,
        // when GBC cart is inserted, this signal when low or weak will pull GBC /RES low with a special circuit
        // the goal is that when unconfigured, the FPGA weak pullups won't interfere.
        // thus, if GBC cart is inserted, FPGA must drive this high in order to let the level translators
        // and general IO drive this pin.
        output  wire            cart_pin30_pwroff_reset,

        // GBA IRQ/DRQ
        inout   wire            cart_tran_pin31,
        output  wire            cart_tran_pin31_dir,
		...
``` 

| SIGNAL                 | TYPE     | LONG  | FUNCTION                                                                                                       |
| :--------------------: | :------: | :---: | :------------------------------------------------------------------------------------------------------------: |
| MASTER_CLK_FREQ        | PARAMETER|       | This parameter is used to calculate the delay in timing signals for SNAC                                       |
| i_clk                  | INPUT    | 1     | main clock. It can be the core master clock or the video clock.                                                |
| i_rst                  | INPUT    | 1     | reset signal active at high. Resets the interface and keeps the cartridge port in the default state            |
| i_ena                  | INPUT    | 1     | enable signal. If disabled, it keeps the cartridge port in the default state                                   |
| analog_video_type      | INPUT    | 4     | Select Analogizer video output through the video output port                                                   |
| R                      | INPUT    | 8     | color channel R. Internally it is reduced to the 6 bits with the highest weight                                |
| G                      | INPUT    | 8     | color channel G. Internally it is reduced to the 6 bits with the highest weight                                |
| B                      | INPUT    | 8     | color channel B. Internally it is reduced to the 6 bits with the highest weight                                |
| HBlank                 | INPUT    | 1     | horizontal blanking signal                                                                                     |
| VBlank                 | INPUT    | 1     | vertical blanking signal                                                                                       |
| BLANKn                 | INPUT    | 1     | active low composite blanking signal (ADV7123 requires it for RGBS, RGsB video output)                         |
| Hsync                  | INPUT    | 1     | horizontal synchronization signal                                                                              |
| Vsync                  | INPUT    | 1     | vertical synchronization signal                                                                                |
| Csync                  | INPUT    | 1     | composite synchronization signal. The generation of this signal is specific to each core                       |
| video_clk              | INPUT    | 1     | video clock for the ADV7123. Depending on the core, this signal may be the same as i_clk or another specific   |
| PALFLAG                | INPUT    | 1     | Y/C specific signal. Allows you to adapt SVideo and composite video to PAL(=1) or NTSC(=0)                     |
| MUFLAG                 | INPUT    | 1     | specific Y/C signal (DEBUG). Modifies the way the phase accumulator is calculated (default =0)                 |
| CHROMA_ADD             | INPUT    | 5     | specific Y/C signal (DEBUG). Allows you to adjust the value of the phase accumulator in the development phase  |
| CHROMA_MULT            | INPUT    | 5     | specific Y/C signal (DEBUG). Allows you to adjust the value of the phase accumulator in the development phase  |
| CHROMA_MULT            | INPUT    | 5     | specific Y/C signal (DEBUG). Allows you to adjust the value of the phase accumulator in the development phase  |
| CHROMA_PHASE_INC       | INPUT    | 40    | Y/C specific signal. Tuned phase accumulator step value for core frequency                                     |
| COLORBURST_RANGE       | INPUT    | 27    | Y/C specific signal. Tuned color burst value for core video frequency                                          |
| ce_divider             | INPUT    | 3     | Scandoubler RGBHV specifies signal. Pixel clock divider. Use value that best fits the image                    |
| conf_AB                | INPUT    | 3     | SNAC signal. Configuration A or B for SNAC game controllers. It must match the position of the A/B switch      |
| game_cont_type         | INPUT    | 5     | SNAC signal. Specifies if SNAC commands are not used and if what type are used (See interact.json file)        |
| p1_btn_state           | OUTPUT   | 16    | SNAC signal. Status of SNAC control buttons for player1 (ST,SEL,R3,L3,R2,L2,R1,L1,Y,X,B,A,R,L,D,U)             |
| p2_btn_state           | OUTPUT   | 16    | SNAC signal. Status of SNAC control buttons for player2 (ST,SEL,R3,L3,R2,L2,R1,L1,Y,X,B,A,R,L,D,U)             |
| p3_btn_state           | OUTPUT   | 16    | SNAC signal. Status of SNAC control buttons for player3 (ST,SEL,R3,L3,R2,L2,R1,L1,Y,X,B,A,R,L,D,U)             |
| p4_btn_state           | OUTPUT   | 16    | SNAC signal. Status of SNAC control buttons for player4 (ST,SEL,R3,L3,R2,L2,R1,L1,Y,X,B,A,R,L,D,U)             |
| cart_tran_bank2        | I/O      | 8     | Interface with the cartridge port. Connects directly to the signals of the higher level module                 |
| cart_tran_bank2_dir    | OUTPUT   | 1     | Interface with the cartridge port. Connects directly to the signals of the higher level module                 |
| cart_tran_bank3        | I/O      | 8     | Interface with the cartridge port. Connects directly to the signals of the higher level module                 |
| cart_tran_bank3_dir    | OUTPUT   | 1     | Interface with the cartridge port. Connects directly to the signals of the higher level module                 |
| cart_tran_bank1        | I/O      | 8     | Interface with the cartridge port. Connects directly to the signals of the higher level module                 |
| cart_tran_bank1_dir    | OUTPUT   | 1     | Interface with the cartridge port. Connects directly to the signals of the higher level module                 |
| cart_tran_bank0        | I/O      | 4     | Interface with the cartridge port. Connects directly to the signals of the higher level module                 |
| cart_tran_bank0_dir    | OUTPUT   | 1     | Interface with the cartridge port. Connects directly to the signals of the higher level module                 |
| cart_tran_pin30        | I/O      | 1     | Interface with the cartridge port. Connects directly to the signals of the higher level module                 |
| cart_tran_pin30_dir    | OUTPUT   | 1     | Interface with the cartridge port. Connects directly to the signals of the higher level module                 |
| cart_pin30_pwroff_reset| OUTPUT   | 1     | Interface with the cartridge port. Connects directly to the signals of the higher level module                 |
| cart_tran_pin31        | I/O      | 1     | Interface with the cartridge port. Connects directly to the signals of the higher level module                 |
| cart_tran_pin31_dir    | OUTPUT   | 1     | Interface with the cartridge port. Connects directly to the signals of the higher level module                 |
| o_stb                  | OUTPUT   | 1     | Interface with the cartridge port. Connects directly to the signals of the higher level module                 |

Normally the `openFPGA_Pocket_Analogizer` module is instantiated at a lower level, where the core module is instantiated.
The only thing that is required is to connect the required signals between the core of the machine that is going to be executed and the instance of the module.
Analogizer:
